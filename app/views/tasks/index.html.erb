<script>
  function play_good() {
    var audio_good = document.getElementById("si");
    audio_good.play();
  }
  function play_bad() {
    var audio_bad = document.getElementById("sad_violin");
    audio_bad.play();
  }
</script>

<audio id="wahwahwah" src="<%= asset_path('wahwahwah.mp3') %>"></audio>
<audio id="sad_violin" src="<%= asset_path('sad_violin.mp3') %>"></audio>
<audio id="spongebob-fail" src="<%= asset_path('spongebob-fail.mp3') %>"></audio>
<audio id="si" src="<%= asset_path('si.mp3') %>"></audio>
<audio id="done" src="<%= asset_path('done.mp3') %>"></audio>
<audio id="beep" src="<%= asset_path('beep.mp3') %>"></audio>
<audio id="coins" src="<%= asset_path('coins.mp3') %>"></audio>
<audio id="oou" src="<%= asset_path('oou.mp3') %>"></audio>
<audio id="piu" src="<%= asset_path('piu.mp3') %>"></audio>
<audio id="wet" src="<%= asset_path('wet.mp3') %>"></audio>
<audio id="accomplished" src="<%= asset_path('accomplished.mp3') %>"></audio>
<audio id="ddd" src="<%= asset_path('ddd.mp3') %>"></audio>
<audio id="elegant" src="<%= asset_path('elegant.mp3') %>"></audio>
<audio id="error" src="<%= asset_path('error.mp3') %>"></audio>
<audio id="p" src="<%= asset_path('p.mp3') %>"></audio>
<audio id="smile-ringtone" src="<%= asset_path('smile-ringtone.mp3') %>"></audio>
<audio id="swiftly" src="<%= asset_path('swiftly.mp3') %>"></audio>
<audio id="system-fault" src="<%= asset_path('system-fault.mp3') %>"></audio>
<audio id="yo" src="<%= asset_path('yo.mp3') %>"></audio>

<% if user_signed_in?%>
  <p style="color: green"><%= notice %></p>
    <h1>Pending tasks</h1>
    <%= link_to "New task", new_task_path, type:"button", id: "btn-add", class: "btn glow-on-hover", style:'color:white;font-size:25px' %>
    <br/>
    <div id="pending-tasks">
    <% if @tasks.where(completed: false).count.zero?%>
          <p style="font-size:20px;text-align:center">All tasks are completed! Congratulations!</p>
          <img src = "<%= image_path('completed.jpg') %>" alt= "completed_image" style="width:25%;margin-left:37%">
    <%end%>
    
    <% @tasks.all.order('created_at DESC').each do |task| %>
      <% if task.completed == false%>
        <div id="<%= dom_id task %>" class="task">

        <%=button_to " ", complete_path(task: task), class: 'btn_instead_of_checkbox', onclick:"play_good()"%> 
        <p>
          <%= task.title %>
        </p>

        <a class="link" data-bs-toggle="modal" data-bs-target="#pending<%= dom_id task %>">Open</a>

        <div class="modal fade" id="pending<%= dom_id task %>" tabindex="-1" aria-labelledby="open_label" aria-hidden="true">
          <div class="modal-dialog  modal-xl">
            <div class="modal-content">
              <div class="modal-header">
                <h4 class="modal-title" id="open_label">Task</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Закрыть"></button>
              </div>
              <div class="modal-body">
                <%= render "task_show", task: task %>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрыть</button>
              </div>
            </div>
          </div>
        </div> 

        </div>
      <%end%>  
    <% end %>
  </div>

    <details >
      <summary>
      Completed tasks
      <%= form_with url: "/choose", method: :post, id: 'options'  do |form|%>
        <%= form.select :option, [["today", "today"], ["this week", "week"], ["this month", "month"], ["all the time", "all"]], selected: @option, onchange: 'this.form.submit()' %>
        <%= form.submit 'show'%>
      <% end %>
      
      </summary>
      <div id="completed-tasks">
        <% if @tasks.where(completed: true).count.zero?%>
          <p>You have no completed tasks yet</p>
        <%end%>
        <% @tasks.all.where(completed: true).order('completed_time DESC').reject{|task| task.completed_time.nil?}.each do |task| %>
          <% if task.completed_time.today? && @option == "today"|| task.completed_time.month == Date.today.month && @option == "month" || task.completed_time.to_date.cweek == Date.today.cweek && @option == "week"|| @option == "all"%>
            <div id="<%= dom_id task %>" class="task">
            <%=button_to " ", uncomplete_path(:task => task), class: 'btn_instead_of_checkbox_return', onclick:"play_bad()"%>
            <div style="text-decoration: line-through">
              <p>
                <%= task.title %>
              </p>
            </div>
            <a class="link" data-bs-toggle="modal" data-bs-target="#pending<%= dom_id task %>">Open</a>
            <div class="modal fade" id="pending<%= dom_id task %>" tabindex="-1" aria-labelledby="open_label" aria-hidden="true">
              <div class="modal-dialog  modal-xl">
                <div class="modal-content">
                  <div class="modal-header">
                    <h4 class="modal-title" id="open_label">Task</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Закрыть"></button>
                  </div>
                  <div class="modal-body">
                    <%= render "task_show", task: task %>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрыть</button>
                  </div>
                </div>
              </div>
            </div>
          
          </div>
          <%end%>  
        <% end %>
      </div>
    </details>
<%end%>

